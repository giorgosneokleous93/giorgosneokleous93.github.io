<!DOCTYPE html>


<html lang="en-us" data-theme="">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Sweet Truth, the Truth fairy ü¶∑ - Giorgos Neokleous</title>
<meta name="description" content="Giorgos Neokleous&#39;s stories about Android Development and Programming!">

<link rel="icon" type="image/x-icon" href="https://www.giorgosneokleous.com/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://www.giorgosneokleous.com/favicon.png">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<link rel="stylesheet" href="https://www.giorgosneokleous.com/css/light.css?rnd=1600289964" />
<style>

    [data-theme="dark"] {   
        --font-color: #eee;
--bg-color: #212121;

--link-color:#599ada;
--link-state-color:#ff5858;
--link-state-border-color: rgba(238, 54, 54, 0.5);

--thead-bg-color: #343a40;
--table-border-color: lightgrey;

--pre-color: #333;
--pre-bg-color: #f1f1f1;

--bq-color: #ccc;
--hr-color: #333;

--pagination-bg-color: #373737;
--pagination-link-color: #b6b6b6;

--post-info-color: grey;

--switcher-color: #333;
--switcher-bg-color: #fff;



    }

</style>

<link rel="stylesheet" href="https://www.giorgosneokleous.com/css/style.css?rnd=1600289964" />





<meta property="og:title" content="Sweet Truth, the Truth fairy ü¶∑" />
<meta property="og:description" content="Exploring Google&#39;s Truth Assertion Library" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.giorgosneokleous.com/post/sweet-truth-the-truth-fairy/" />
<meta property="og:image" content="https://www.giorgosneokleous.com/posts/sweet-truth-the-truth-fairy-banner.png" />
<meta property="article:published_time" content="2019-09-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-18T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.giorgosneokleous.com/posts/sweet-truth-the-truth-fairy-banner.png"/>

<meta name="twitter:title" content="Sweet Truth, the Truth fairy ü¶∑"/>
<meta name="twitter:description" content="Exploring Google&#39;s Truth Assertion Library"/>






    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-84803609-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <h1 class="site-title">
    <a href="/">Giorgos Neokleous</a>
</h1>

    <nav>
        
        
        <a class="" href="https://www.giorgosneokleous.com/about/" title=""> <span>about</span></a>
        
        <a class="" href="https://www.giorgosneokleous.com/posts/" title=""> <span>blog</span></a>
        
        <a class="" href="https://twitter.com/neokleoys2005" title=""><i class='fa fa-twitter'></i> <span></span></a>
        
        <a class="" href="https://www.linkedin.com/in/giorgos-neokleous/" title=""><i class='fa fa-linkedin'></i> <span></span></a>
        
        <a class="" href="https://github.com/giorgosneokleous93/" title=""><i class='fa fa-github-square'></i> <span></span></a>
        
        <a class="" href="https://stackoverflow.com/users/3330058/giorgos-neokleous" title=""><i class='fa fa-stack-overflow'></i> <span></span></a>
        
    </nav>


            
        </header>
        <main id="main" tabindex="-1"> 
            
    
    
    <article class="post">
        <header class="post-header">
            <h1 class="post-title">Sweet Truth, the Truth fairy ü¶∑</h1>
        </header>
        <div class="content">
            <p>Writing tests is an important part of software development and dare to say not an easy task. There are many practices, libraries, books, podcasts, web courses dedicated to testing. Without testing we can ship a software with ‚Äú1 to N‚Äù number of bugs.</p>
<p>Personally, I am a fan of the following technique which helps developers write tests and provides a template guide on how-to form your tests.</p>
<h3 id="arrange-act-assert-aaa">Arrange Act Assert (AAA)</h3>
<blockquote>
<p>a pattern for arranging and formatting code in [UnitTest](a pattern for arranging and formatting code in UnitTest methods
) methods</p>
</blockquote>
<p>It states that each unit test needs the following three things:</p>
<ol>
<li>Arrange: prepare the inputs, preconditions, mocks, etc.</li>
<li>Act: Perform operation on the function or object which is under test.</li>
<li>Assert: Make sure that the output matches the expected output.</li>
</ol>
<p><strong>Example</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Test
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`example of AAA`</span>() {
    <span style="color:#75715e">// Arrange
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> input = <span style="color:#ae81ff">2</span>
    <span style="color:#75715e">// Act
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">val</span> output = toThePowerOfTwo(number = input)
    <span style="color:#75715e">// Assert
</span><span style="color:#75715e"></span>    Assert.assertEquals(<span style="color:#ae81ff">4</span>, output)
}
</code></pre></div><p>On this blog post we are going to focused on the <strong>Assertions</strong> part.</p>
<h2 id="junit-assertions">JUnit Assertions</h2>
<p>JUnit comes with a set of pretty basic assertions which can be used during testing.</p>
<p>The whole set can be found at their <a href="https://junit.org/junit4/javadoc/latest/org/junit/Assert.html">JavaDoc</a>.</p>
<p>JUnit also comes with the <a href="http://hamcrest.org/JavaHamcrest/index">Hamcrest</a> assertions which are very nice!</p>
<p><strong>Hamcrest Example</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Test
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`example of Hamcrest`</span>(){
    <span style="color:#66d9ef">val</span> input = <span style="color:#ae81ff">2</span>

    <span style="color:#66d9ef">val</span> output = toThePowerOfTwo(input)

    Assert.assertThat(output, CoreMatchers.`is`(<span style="color:#ae81ff">4</span>))
}
</code></pre></div><p>In my opinion matchers are a much readable form of unit tests as it can be easily expressed, also the unit tests failures are much more readable.</p>
<p>Let‚Äôs go one step beyond now and introduce the main star of the post, <a href="https://truth.dev/">Truth</a>.</p>
<h2 id="truth">Truth</h2>
<p>Truth is an assertion library, that comes with assertions and nice failure messages and as a result of that much more readable unit tests ‚ô•Ô∏è.</p>
<blockquote>
<p>Truth is owned and maintained by the <a href="https://github.com/google/guava">Guava</a> team. It is used in the majority of the tests in Google‚Äôs own codebase.</p>
</blockquote>
<p>Truth‚Äôs API enables chained method calls, this is a huge win for me as it‚Äôs easier to read.</p>
<p><strong>Example 1</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Test
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`example one of Truth`</span>() {
    Truth.assertThat(getUsers()).containsEntry(<span style="color:#e6db74">&#34;User 1&#34;</span>, <span style="color:#e6db74">&#34;John Doe&#34;</span>)
}
</code></pre></div><p>The above example can be easily read as: ‚ÄúAssert that getAllUsers() returns a map with an entry with key: User 1 and value John Doe. Truth can also be imported statically so you can no always add Truth.*.</p>
<p>A failure message of the above would look like:</p>
<pre><code>value of: map.get(User 2)
expected: John Doe
but was : John Wick
map was : {User 1=John Doe, User 2=John Wick, User 3=Steve Rogers}
Expected :John Doe
Actual   :John Wick
</code></pre><p>Much much easier to understand what went wrong! üëèüéâ</p>
<p>Full JavaDoc for Truth can be found at: <a href="https://truth.dev/api/1.0/">https://truth.dev/api/1.0/</a></p>
<p><strong>Example 2</strong>
Check that a list contains the items you expect and in the correct order.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">Test
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`example two of Truth`</span>() {
    Truth.assertThat(getAllUsernames())
        .containsExactly(<span style="color:#e6db74">&#34;User 1&#34;</span>, <span style="color:#e6db74">&#34;User 2&#34;</span>, <span style="color:#e6db74">&#34;User 3&#34;</span>)
        .inOrder()
}
</code></pre></div><p>A failure message of the above would look like:</p>
<pre><code>contents match, but order was wrong
expected: [User 2, User 1, User 3]
but was : [User 1, User 2, User 3]
</code></pre><p><strong>Example 3</strong>
Assertions on String objects.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">@Test
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">`example three of Truth`</span>() {
    <span style="color:#66d9ef">val</span> user = getRandomUser()

    Truth.assertThat(user.name).contains(<span style="color:#e6db74">&#34;John&#34;</span>)
    Truth.assertThat(user.username).startsWith(<span style="color:#e6db74">&#34;User&#34;</span>)
}

</code></pre></div><p>A failure message of the above would look like:</p>
<pre><code>expected to contain: Steve
but was            : John Doe
</code></pre><p><strong>Example 4</strong>
With Kotlin‚Äôs extension functions we can power up Truth üÜôüí™</p>
<p>With the following extension we can chain multiple assertions, Truth allows one at time, except if the method allows it, like <em>Example 2</em>.</p>
<p>The only downside is that failures will be invoked on the first call and not the subsequent ones.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * Invoke multiple calls on [T] objects.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">fun</span> &lt;T : Subject&gt; <span style="color:#a6e22e">T</span>.toTruthSerum(<span style="color:#66d9ef">vararg</span> calls: T.() -&gt; Unit) {
    calls.forEach { it.invoke(<span style="color:#66d9ef">this</span>@toTruthSerum) }
}

<span style="color:#75715e">// how to use
</span><span style="color:#75715e"></span>@Test
<span style="color:#66d9ef">fun</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#a6e22e">example</span> four of Truth - with kotlin extensions<span style="color:#960050;background-color:#1e0010">`</span>() {
    <span style="color:#66d9ef">val</span> user = getJohnWick()

    Truth.assertThat(user.name).toTruthSerum(
        { startsWith(<span style="color:#e6db74">&#34;John&#34;</span>) },
        { endsWith(<span style="color:#e6db74">&#34;Wick&#34;</span>) }
    )
} 
</code></pre></div><p>A failure message of the above would look like:</p>
<pre><code>expected to start with: Wick
but was               : John Wick
</code></pre><h3 id="conclusion">Conclusion</h3>
<p>I really like Truth! It can make testing really really fun ü•≥ and easier to debug. Refactoring tests or failing tests can be an easy-peasy task now!</p>
<p>I wish it had better support for Kotlin to enable some of the language features, e.g. named parameters which will make our tests even more readable. At example #1, it would nice to have instead of:</p>
<p><code>#containsEntry(&quot;User 1&quot;, &quot;John Doe&quot;)</code></p>
<p>to have:</p>
<p><code>#containsEntry(key = &quot;User 1&quot;, value = &quot;John Doe&quot;)</code></p>
<p>To finish off, do and use whatever suits you. Especially for testing, adding new dependencies doesn‚Äôt increase app size, nor method count for your shipped product. On the contrary it will help you write better (hopefully ü§û) tests (and don‚Äôt overdo it with the dependencies just because you can).</p>
<p>Feel free to ping me on <a href="https://twitter.com/neokleoys2005">twitter</a>.</p>
<p>Till next time! üëã</p>

        </div>
        

    


<div class="post-info">
    
        <div class="post-date">2019-09-18</div>
    
    <div class="post-taxonomies">
        
            
    </div>
</div>

    </article>

    
        
    <div class="pagination post-pagination">
        <div class="left pagination-item ">
            
                <a href="/post/mock-responses-with-okhttp-retrofit/">Mock Responses with OkHttp &amp; Retrofit</a>
            
        </div>
        <div class="right pagination-item disabled">
            
        </div>
    </div>

    

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-giorgosneokleous-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            <p>¬© Giorgos Neokleous, 2020<br>
            Powered by <a target="_blank" rel="noopener noreferrer" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" rel="noopener noreferrer" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.
            </p>  
        </div> 

        

    



    <button class="theme-switcher">
        Dark theme
    </button>

    <script>
    const STORAGE_KEY = 'user-color-scheme'
    const defaultTheme = "dark"

    let currentTheme
    let switchButton
    let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

    const autoChangeScheme = e => {
        currentTheme = e.matches ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', currentTheme)
        changeButtonText()
    }

    document.addEventListener('DOMContentLoaded', function() {
        switchButton = document.querySelector('.theme-switcher')
        currentTheme = detectCurrentScheme()
        if (currentTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark')
        }
        if (currentTheme == 'auto') {
            autoChangeScheme(autoDefinedScheme);
            autoDefinedScheme.addListener(autoChangeScheme);
        }
        changeButtonText()
        switchButton.addEventListener('click', switchTheme, false)
    })

    function detectCurrentScheme() {
        if (localStorage.getItem(STORAGE_KEY)) {
            return localStorage.getItem(STORAGE_KEY)
        } 
        if (defaultTheme) {
            return defaultTheme
        } 
        if (!window.matchMedia) {
            return 'light'
        } 
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark'
        }
        return 'light'
    }

    function changeButtonText()
    {   
        switchButton.textContent = currentTheme == 'dark' ?  "Light theme" : "Dark theme"
    }

    function switchTheme(e) {
        if (currentTheme == 'dark') {
            localStorage.setItem(STORAGE_KEY, 'light')
            document.documentElement.setAttribute('data-theme', 'light')
            currentTheme = 'light'
        } else {
            localStorage.setItem(STORAGE_KEY, 'dark')
            document.documentElement.setAttribute('data-theme', 'dark')
            currentTheme = 'dark'
        }
        changeButtonText()
    }
    </script>
   
    </div>
</footer>

        
    </div>
</body>
</html>
